<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Skilled Worker Salary Checker</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
  body { font-family: system-ui, sans-serif; max-width: 900px; margin: 2rem auto; padding: 0 1rem; line-height: 1.5; }
  h1 { margin-bottom: .25rem; }
  .panel { background:#fafafa; padding:1.25rem; border:1px solid #ddd; border-radius:8px; margin-bottom:1.75rem; }
  label { font-weight:600; display:block; margin-top:.75rem; }
  input, select { width:100%; max-width:420px; padding:.45rem; border:1px solid #bbb; border-radius:5px; margin-top:.25rem; }
  button { margin-top:1rem; padding:.75rem 1.25rem; border:none; border-radius:5px; background:#0043a4; color:#fff; cursor:pointer; font-size:1rem; }
  button:hover { background:#00347e; }
  .info { background:#f2f7fc; border-left:4px solid #0043a4; padding:.75rem 1rem; margin-top:1rem; border-radius:4px; font-size:.9rem; }
  .result { padding:1rem; border-radius:8px; margin-top:1rem; }
  .ok { background:#eaf8ef; border:1px solid #1c7d3a; }
  .fail { background:#fdecee; border:1px solid #b62334; }
  .small { font-size:.85rem; color:#666; }
</style>
</head>

<body>

<h1>Skilled Worker Salary Checker</h1>
<p class="small">
  This tool gives an indicative comparison against Skilled Worker visa salary rules.
  Always verify figures on GOV.UK and seek legal advice for immigration decisions.
</p>

<!-- Content panels go here, unchanged -->
<!-- Keep your original UI structure -->

<script>
let socData = [];

async function loadCSV() {
  const text = await fetch("soc_full_for_calculator.csv").then(r => r.text());
  const rows = text.trim().split("\n");
  const headers = rows.shift().split(",");

  socData = rows.map(row => {
    const cols = row.split(",");
    let obj = {};
    headers.forEach((h, i) => {
      const key = h.trim();
      const val = cols[i] ? cols[i].trim() : "";
      obj[key] = val;
    });
    return obj;
  });

  populateDropdown(socData);
}

function populateDropdown(list) {
  const select = document.getElementById("socSelect");
  select.innerHTML = "";
  list.forEach(r => {
    const opt = document.createElement("option");
    opt.value = r.SOC_code;
    opt.textContent = `${r.SOC_code} — ${r.Job_type}`;
    select.appendChild(opt);
  });
  updateJobInfo();
}

function updateJobInfo() {
  const select = document.getElementById("socSelect");
  const soc = select.value;
  const role = socData.find(r => r.SOC_code === soc);
  const infoDiv = document.getElementById("jobInfo");

  if (!role) {
    infoDiv.textContent = "";
    return;
  }

  infoDiv.textContent = `Standard annual going rate: £${Number(role.Standard_going_rate_annual).toLocaleString()} (lower rate: £${Number(role.Lower_going_rate_annual).toLocaleString()}).`;
}

document.getElementById("socSelect").addEventListener("change", updateJobInfo);

document.getElementById("searchJob").addEventListener("input", function () {
  const q = this.value.toLowerCase();
  const filtered = socData.filter(r =>
    (r.SOC_code || "").includes(q) ||
    (r.Job_type || "").toLowerCase().includes(q) ||
    (r.Related_job_titles || "").toLowerCase().includes(q)
  );
  populateDropdown(filtered);
});

document.getElementById("checkBtn").addEventListener("click", function () {
  const soc = document.getElementById("socSelect").value;
  const role = socData.find(r => r.SOC_code === soc);
  if (!role) return alert("Select an occupation.");

  const hours = parseFloat(document.getElementById("hours").value);
  const offered = parseFloat(document.getElementById("salary").value);
  const scenario = document.querySelector("input[name='scenario']:checked").value;
  if (!offered) return alert("Enter a salary.");

  let goingRate = parseFloat(role.Standard_going_rate_annual);
  let lowerRate = parseFloat(role.Lower_going_rate_annual);
  if (isNaN(goingRate)) goingRate = 0;
  if (isNaN(lowerRate)) lowerRate = goingRate;

  let required = goingRate;
  if (scenario === "newEntrant" || scenario === "isl") required = lowerRate;
  if (scenario === "phdNonStem") required = Math.max(goingRate * 0.9, 37500);
  if (scenario === "phdStem" || scenario === "newEntrant") required = Math.max(goingRate * 0.8, 33400);
  if (scenario === "isl") required = Math.max(goingRate, 33400);

  const hourly = offered / (Math.min(hours, 48) * 52);
  const meetsHourly = hourly >= 17.13;

  const results = document.getElementById("results");
  results.innerHTML = "";

  const div = document.createElement("div");
  div.classList.add("result");

  if (offered >= required && meetsHourly) {
    div.classList.add("ok");
    div.innerHTML = `<strong>Eligible</strong><br>Salary meets required minimum: £${required.toLocaleString()}<br>Hourly rate: £${hourly.toFixed(2)} (meets £17.13/hr)`;
  } else {
    div.classList.add("fail");
    div.innerHTML = `<strong>Not eligible</strong><br>Required salary: £${required.toLocaleString()}<br>Hourly rate: £${hourly.toFixed(2)} (${meetsHourly ? "meets hourly" : "below minimum £17.13/hr"})`;
  }

  results.appendChild(div);
});

loadCSV();
</script>

</body>
</html>

