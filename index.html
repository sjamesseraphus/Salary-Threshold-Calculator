<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Skilled Worker Salary Checker</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <style>
    body { font-family: system-ui, sans-serif; max-width: 900px; margin: 2rem auto; padding: 0 1rem; line-height: 1.5; }
    h1 { margin-bottom: .25rem; }
    .panel { background:#fafafa; padding:1.25rem; border:1px solid #ddd; border-radius:8px; margin-bottom:1.75rem; }
    label { font-weight:600; display:block; margin-top:.75rem; }
    input, select { width:100%; max-width:420px; padding:.45rem; border:1px solid #bbb; border-radius:5px; margin-top:.25rem; }
    button { margin-top:1rem; padding:.75rem 1.25rem; border:none; border-radius:5px; background:#0043a4; color:#fff; cursor:pointer; font-size:1rem; }
    button:hover { background:#00347e; }
    .info { background:#f2f7fc; border-left:4px solid #0043a4; padding:.75rem 1rem; margin-top:1rem; border-radius:4px; font-size:.9rem; }
    .result { padding:1rem; border-radius:8px; margin-top:1rem; }
    .ok { background:#eaf8ef; border:1px solid #1c7d3a; }
    .fail { background:#fdecee; border:1px solid #b62334; }
    .small { font-size:.85rem; color:#666; }
  </style>
</head>

<body>

<h1>Skilled Worker Salary Checker</h1>
<p class="small">
  This tool gives an indicative comparison against Skilled Worker visa salary rules.
  Always verify figures on GOV.UK and seek legal advice for immigration decisions.
</p>

<div class="panel">
  <h2>1. Find the occupation</h2>

  <label>Search job title or SOC code</label>
  <input id="searchJob" type="text" placeholder="e.g. nurse, engineer, 2231…">

  <label>Select SOC code</label>
  <select id="socSelect"></select>

  <div id="jobInfo" class="small"></div>
</div>

<div class="panel">
  <h2>2. Hours & salary</h2>
  <label>Weekly hours</label>
  <input id="hours" type="number" value="37.5" min="1" step="0.1">

  <label>Proposed annual salary (£)</label>
  <input id="salary" type="number" step="100">
</div>

<div class="panel">
  <h2>3. Scenario</h2>
  <label><input type="radio" name="scenario" value="standard" checked> Standard</label>
  <label><input type="radio" name="scenario" value="newEntrant"> New Entrant</label>
  <label><input type="radio" name="scenario" value="phdNonStem"> PhD (Non-STEM)</label>
  <label><input type="radio" name="scenario" value="phdStem"> PhD (STEM)</label>
  <label><input type="radio" name="scenario" value="isl"> Immigration Salary List</label>
</div>

<div class="panel">
  <h2>4. Check salary</h2>
  <button id="checkBtn">Check salary</button>
  <div id="results"></div>
</div>

<script>
const GENERAL_THRESHOLD = 41700;
const FLOOR_NEW_ENTRANT = 33400;
const FLOOR_PHD_NON_STEM = 37500;
const HOURLY_MIN = 17.13;
const WEEKS_PER_YEAR = 52;
const MAX_HOURS_FOR_TEST = 48;

let socData = [];

// LOAD CSV
async function loadCSV() {
  const res = await fetch("soc_full_for_calculator.csv");
  const text = await res.text();
  const rows = text.trim().split("\n");
  const headers = rows.shift().split(",");

  socData = rows.map(row => {
    const cols = row.split(",");
    const obj = {};
    headers.forEach((h,i)=>obj[h.trim()] = (cols[i] || "").trim());
    return obj;
  });

  populateDropdown(socData);
}

// POPULATE DROPDOWN
function populateDropdown(list){
  const sel = document.getElementById("socSelect");
  sel.innerHTML = "";
  list.forEach(r=>{
    const opt=document.createElement("option");
    opt.value=r.SOC_code;
    opt.textContent = `${r.SOC_code} — ${r.Job_title}`;
    sel.appendChild(opt);
  });
  updateJobInfo();
}

// JOB INFO
function updateJobInfo(){
  const soc = socSelect.value;
  const role = socData.find(r=>r.SOC_code===soc);
  jobInfo.textContent = role
    ? `Standard annual going rate: £${Number(role.Standard_going_rate_annual).toLocaleString()}`
    : "";
}

socSelect.addEventListener("change", updateJobInfo);

// SEARCH
searchJob.addEventListener("input", function(){
  const q=this.value.toLowerCase();
  populateDropdown(
    socData.filter(r =>
      r.SOC_code.toLowerCase().includes(q) ||
      r.Job_title.toLowerCase().includes(q)
    )
  );
});

// CHECK SALARY
checkBtn.addEventListener("click", function(){
  const soc=socSelect.value;
  const role=socData.find(r=>r.SOC_code===soc);

  const offered=parseFloat(salary.value);
  const hours=Math.min(parseFloat(hoursInput=hours.value),48);
  const scenario=document.querySelector("input[name='scenario']:checked").value;

  let required;
  const goingRate=Number(role.Standard_going_rate_annual);

  if(scenario==="standard") required=Math.max(GENERAL_THRESHOLD, goingRate);
  if(scenario==="newEntrant") required=Math.max(goingRate*0.7, FLOOR_NEW_ENTRANT);
  if(scenario==="phdNonStem") required=Math.max(goingRate*0.9, FLOOR_PHD_NON_STEM);
  if(scenario==="phdStem") required=Math.max(goingRate*0.8, FLOOR_NEW_ENTRANT);
  if(scenario==="isl") required=Math.max(goingRate, FLOOR_NEW_ENTRANT);

  const hourly=offered/(hours*WEEKS_PER_YEAR);
  const ok=offered>=required && hourly>=HOURLY_MIN;

  results.innerHTML = ok
    ? `<div class="result ok">Eligible — Required £${required.toLocaleString()} | Hourly £${hourly.toFixed(2)}</div>`
    : `<div class="result fail">Not Eligible — Required £${required.toLocaleString()} | Hourly £${hourly.toFixed(2)}</div>`;
});

loadCSV();
</script>

</body>
</html>
